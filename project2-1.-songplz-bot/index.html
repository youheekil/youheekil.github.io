<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="robots" content="noodp" />
        <title>[SongPlz-Bot] 1. Slack and Spotify API - YOUHEE</title><meta name="Description" content=""><meta property="og:title" content="[SongPlz-Bot] 1. Slack and Spotify API" />
<meta property="og:description" content="SongPlz Bot - Slack and Spotify API What is API API stands for Application Programming Interface. The most common example to describe the API is being a waiter in the restaurant.
  Interface between human and object   Interface  Interface is a program that allows a user to interact computers in person or over a network, which is a software intermediary that allows two applications to talk to each other" />
<meta property="og:type" content="article" />
<meta property="og:url" content="http://youheekil.github.io/project2-1.-songplz-bot/" />
<meta property="og:image" content="http://youheekil.github.io/logo.png"/>
<meta property="article:published_time" content="2022-05-22T00:00:00+00:00" />
<meta property="article:modified_time" content="2022-05-22T00:00:00+00:00" /><meta property="og:site_name" content="YOUHEE" />
<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="http://youheekil.github.io/logo.png"/>

<meta name="twitter:title" content="[SongPlz-Bot] 1. Slack and Spotify API"/>
<meta name="twitter:description" content="SongPlz Bot - Slack and Spotify API What is API API stands for Application Programming Interface. The most common example to describe the API is being a waiter in the restaurant.
  Interface between human and object   Interface  Interface is a program that allows a user to interact computers in person or over a network, which is a software intermediary that allows two applications to talk to each other"/>
<meta name="application-name" content="YOUHEE">
<meta name="apple-mobile-web-app-title" content="YOUHEE"><meta name="theme-color" content="#ffffff"><meta name="msapplication-TileColor" content="#da532c"><link rel="icon" href="favicon.ico"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5"><link rel="manifest" href="/site.webmanifest"><link rel="canonical" href="http://youheekil.github.io/project2-1.-songplz-bot/" /><link rel="prev" href="http://youheekil.github.io/running-kafka-docker/" /><link rel="next" href="http://youheekil.github.io/project2-2.-songplz-bot/" /><link rel="stylesheet" href="/css/style.min.css"><link rel="preload" href="/lib/fontawesome-free/all.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
        <noscript><link rel="stylesheet" href="/lib/fontawesome-free/all.min.css"></noscript><link rel="preload" href="/lib/animate/animate.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
        <noscript><link rel="stylesheet" href="/lib/animate/animate.min.css"></noscript><script type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "BlogPosting",
        "headline": "[SongPlz-Bot] 1. Slack and Spotify API",
        "inLanguage": "en",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "http:\/\/youheekil.github.io\/project2-1.-songplz-bot\/"
        },"genre": "posts","wordcount":  1298 ,
        "url": "http:\/\/youheekil.github.io\/project2-1.-songplz-bot\/","datePublished": "2022-05-22T00:00:00+00:00","dateModified": "2022-05-22T00:00:00+00:00","publisher": {
            "@type": "Organization",
            "name": "YOUHEE","logo": "http:\/\/youheekil.github.io\/favicon.ico"},"author": {
                "@type": "Person",
                "name": "Youhee"
            },"description": ""
    }
    </script></head>
    <body data-header-desktop="fixed" data-header-mobile="auto"><script type="text/javascript">(window.localStorage && localStorage.getItem('theme') ? localStorage.getItem('theme') === 'dark' : ('auto' === 'auto' ? window.matchMedia('(prefers-color-scheme: dark)').matches : 'auto' === 'dark')) && document.body.setAttribute('theme', 'dark');</script>

        <div id="mask"></div><div class="wrapper"><header class="desktop" id="header-desktop">
    <div class="header-wrapper">
        <div class="header-title">
            <a href="/" title="YOUHEE"><img
        class="lazyload logo"
        src="/svg/loading.min.svg"
        data-src="https://s.gravatar.com/avatar/83b05cfa42d6bfdbb37962fd78463398?s=80"
        data-srcset="https://s.gravatar.com/avatar/83b05cfa42d6bfdbb37962fd78463398?s=80, https://s.gravatar.com/avatar/83b05cfa42d6bfdbb37962fd78463398?s=80 1.5x, https://s.gravatar.com/avatar/83b05cfa42d6bfdbb37962fd78463398?s=80 2x"
        data-sizes="auto"
        alt="https://s.gravatar.com/avatar/83b05cfa42d6bfdbb37962fd78463398?s=80"
        title="https://s.gravatar.com/avatar/83b05cfa42d6bfdbb37962fd78463398?s=80" /><span id="id-1" class="typeit"></span></a>
        </div>
        <div class="menu">
            <div class="menu-inner"><a class="menu-item" href="/posts/"> Posts </a><a class="menu-item" href="/categories/"> Categories </a><a class="menu-item" href="/tags/"> Tags </a><a class="menu-item" href="/about/"> About </a><span class="menu-item delimiter"></span><span class="menu-item search" id="search-desktop">
                        <input type="text" placeholder="Search titles or contents..." id="search-input-desktop">
                        <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-desktop" title="Search">
                            <i class="fas fa-search fa-fw" aria-hidden="true"></i>
                        </a>
                        <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-desktop" title="Clear">
                            <i class="fas fa-times-circle fa-fw" aria-hidden="true"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-desktop">
                            <i class="fas fa-spinner fa-fw fa-spin" aria-hidden="true"></i>
                        </span>
                    </span><a href="javascript:void(0);" class="menu-item theme-switch" title="Switch Theme">
                    <i class="fas fa-adjust fa-fw" aria-hidden="true"></i>
                </a>
            </div>
        </div>
    </div>
</header><header class="mobile" id="header-mobile">
    <div class="header-container">
        <div class="header-wrapper">
            <div class="header-title">
                <a href="/" title="YOUHEE"><img
        class="lazyload logo"
        src="/svg/loading.min.svg"
        data-src="https://s.gravatar.com/avatar/83b05cfa42d6bfdbb37962fd78463398?s=80"
        data-srcset="https://s.gravatar.com/avatar/83b05cfa42d6bfdbb37962fd78463398?s=80, https://s.gravatar.com/avatar/83b05cfa42d6bfdbb37962fd78463398?s=80 1.5x, https://s.gravatar.com/avatar/83b05cfa42d6bfdbb37962fd78463398?s=80 2x"
        data-sizes="auto"
        alt="https://s.gravatar.com/avatar/83b05cfa42d6bfdbb37962fd78463398?s=80"
        title="https://s.gravatar.com/avatar/83b05cfa42d6bfdbb37962fd78463398?s=80" /><span id="id-2" class="typeit"></span></a>
            </div>
            <div class="menu-toggle" id="menu-toggle-mobile">
                <span></span><span></span><span></span>
            </div>
        </div>
        <div class="menu" id="menu-mobile"><div class="search-wrapper">
                    <div class="search mobile" id="search-mobile">
                        <input type="text" placeholder="Search titles or contents..." id="search-input-mobile">
                        <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-mobile" title="Search">
                            <i class="fas fa-search fa-fw" aria-hidden="true"></i>
                        </a>
                        <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-mobile" title="Clear">
                            <i class="fas fa-times-circle fa-fw" aria-hidden="true"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-mobile">
                            <i class="fas fa-spinner fa-fw fa-spin" aria-hidden="true"></i>
                        </span>
                    </div>
                    <a href="javascript:void(0);" class="search-cancel" id="search-cancel-mobile">
                        Cancel
                    </a>
                </div><a class="menu-item" href="/posts/" title="">Posts</a><a class="menu-item" href="/categories/" title="">Categories</a><a class="menu-item" href="/tags/" title="">Tags</a><a class="menu-item" href="/about/" title="">About</a><a href="javascript:void(0);" class="menu-item theme-switch" title="Switch Theme">
                <i class="fas fa-adjust fa-fw" aria-hidden="true"></i>
            </a></div>
    </div>
</header><div class="search-dropdown desktop">
        <div id="search-dropdown-desktop"></div>
    </div>
    <div class="search-dropdown mobile">
        <div id="search-dropdown-mobile"></div>
    </div><main class="main">
                <div class="container"><div class="toc" id="toc-auto">
            <h2 class="toc-title">Contents</h2>
            <div class="toc-content always-active" id="toc-content-auto"></div>
        </div><article class="page single"><h1 class="single-title animate__animated animate__flipInX">[SongPlz-Bot] 1. Slack and Spotify API</h1><div class="post-meta">
            <div class="post-meta-line"><span class="post-author"><a href="/" title="Author" rel=" author" class="author"><i class="fas fa-user-circle fa-fw" aria-hidden="true"></i>Youhee</a></span>&nbsp;<span class="post-category">included in <a href="/categories/project/"><i class="far fa-folder fa-fw" aria-hidden="true"></i>Project</a></span></div>
            <div class="post-meta-line"><i class="far fa-calendar-alt fa-fw" aria-hidden="true"></i>&nbsp;<time datetime="2022-05-22">2022-05-22</time>&nbsp;<i class="fas fa-pencil-alt fa-fw" aria-hidden="true"></i>&nbsp;1298 words&nbsp;
                <i class="far fa-clock fa-fw" aria-hidden="true"></i>&nbsp;7 minutes&nbsp;</div>
        </div><div class="details toc" id="toc-static"  data-kept="true">
                <div class="details-summary toc-title">
                    <span>Contents</span>
                    <span><i class="details-icon fas fa-angle-right" aria-hidden="true"></i></span>
                </div>
                <div class="details-content toc-content" id="toc-content-static"><nav id="TableOfContents">
  <ul>
    <li><a href="#what-is-api">What is API</a>
      <ul>
        <li><a href="#http-api">HTTP API</a></li>
        <li><a href="#rest-api">REST API</a></li>
      </ul>
    </li>
    <li><a href="#slack-api">Slack API</a>
      <ul>
        <li><a href="#option-1">Option 1.</a></li>
        <li><a href="#option-2">Option 2.</a>
          <ul>
            <li><a href="#code">Code</a></li>
            <li><a href="#error-solved">Error (Solved)</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#spotify-api">Spotify API</a>
      <ul>
        <li>
          <ul>
            <li><a href="#example-bts-song">Example: BTS Song</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#concern-for-better-data-pipeline">Concern for Better Data Pipeline</a></li>
    <li><a href="#reference">Reference</a></li>
  </ul>
</nav></div>
            </div><div class="content" id="content"><h1 id="songplz-bot---slack-and-spotify-api">SongPlz Bot - Slack and Spotify API</h1>
<h2 id="what-is-api">What is API</h2>
<p>API stands for Application Programming Interface. The most common example to describe the API is being a waiter in the restaurant.</p>
<p><figure>
    <img src="interface_between_human_object.png"/> <figcaption>
            <h4>Interface between human and object</h4>
        </figcaption>
</figure>

<div class="details admonition note">
        <div class="details-summary admonition-title">
            <i class="icon fas fa-pencil-alt fa-fw" aria-hidden="true"></i>Interface<i class="details-icon fas fa-angle-right fa-fw" aria-hidden="true"></i>
        </div>
        <div class="details-content">
            <div class="admonition-content"><code>Interface</code> is a program that allows a user to interact computers in person or over a network, which is a software intermediary that allows two applications to talk to each other</div>
        </div>
    </div></p>
<p>Imagine you are sitting at the table in a Mexican restaurant, and you are thinking of ordering taco. You call a waiter to order a Taco Plate. Then, waiter takes a order and tells the kitchen that number 5 table customer ordered Taco Plate. Chef in the Kitchen cooks the Taco Plate. When the food is ready, waiter delivers the food to your table !</p>
<blockquote>
<p>In this example, the kitchen is the part of the <code>system</code> that will prepare your order (<code>user's request</code>), and the waiter is the <code>API</code> that takes your request or order and tells the kitchen (<code>system</code>) what to do and delivers the food (<code>response</code>) to you.</p>
</blockquote>
<p>It can be very dangerous to directly communicate between the <code>system</code> and the <code>user</code>. APIs provides a layer of security so that your system is not fully exposed.</p>
<p>The modern API adhere to standards (typically <em><strong>HTTP</strong></em> and <em><strong>REST</strong></em>), that are developer-friendly, easily accesssible and understood broadly.</p>
<h3 id="http-api">HTTP API</h3>
<p>An <strong>HTTP API</strong> is an API that uses <code>Hypertext Transfer Protocol</code> as the communication protocol between the two systems (<a href="https://www.educative.io/blog/what-are-rest-apis" target="_blank" rel="noopener noreffer">Educative</a>)
<div class="details admonition note">
        <div class="details-summary admonition-title">
            <i class="icon fas fa-pencil-alt fa-fw" aria-hidden="true"></i>Protocol<i class="details-icon fas fa-angle-right fa-fw" aria-hidden="true"></i>
        </div>
        <div class="details-content">
            <div class="admonition-content"><code>Protocol</code> in computer science, a set of rules or procedures for transmitting data between electronic devices, such as computers.
So, for the web, the protocol gives a rule about how a <strong>client</strong> (web browser) and a <strong>server</strong> (web server e.g. udacity.com) talk (<a href="https://www.youtube.com/watch?v=0U31-O4oEPc" target="_blank" rel="noopener noreffer">Udacity</a>).</div>
        </div>
    </div></p>
<h3 id="rest-api">REST API</h3>
<p><strong>REST API</strong> stands for Representational State Transfer and is an <em>architectural pattern</em> for creating web services. It focuses on <code>representational</code> with <strong>URI</strong> and define <code>state</code> with <strong>HTTP</strong> Method. It&rsquo;s essential that REST API&rsquo;s design style strictly has to satisfy CRUD functions only. REST applications use HTTP methods like <code>GET</code>, <code>POST</code>, <code>DELETE</code>, and <code>PUT</code> (<a href="https://www.educative.io/blog/what-are-rest-apis" target="_blank" rel="noopener noreffer">Educative</a>).</p>
<div class="details admonition note">
        <div class="details-summary admonition-title">
            <i class="icon fas fa-pencil-alt fa-fw" aria-hidden="true"></i>CRUD<i class="details-icon fas fa-angle-right fa-fw" aria-hidden="true"></i>
        </div>
        <div class="details-content">
            <div class="admonition-content"><p>CRUD (CREATE, READ, UPDATE, DELETE) is used for anlything related to database and database design.</p>
<table>
<thead>
<tr>
<th>OPERATION</th>
<th>FUNCTION</th>
</tr>
</thead>
<tbody>
<tr>
<td>Create</td>
<td>Insert</td>
</tr>
<tr>
<td>Read</td>
<td>Select</td>
</tr>
<tr>
<td>Update</td>
<td>Edit</td>
</tr>
<tr>
<td>Delete</td>
<td>Delete</td>
</tr>
</tbody>
</table>
</div>
        </div>
    </div>
<h2 id="slack-api">Slack API</h2>
<p>Click <a href="https://slack.com/help/articles/115005265703-Create-a-bot-for-your-workspace" target="_blank" rel="noopener noreffer">here</a> to create a bot for your slack workspace !</p>
<p>After adding your bot into your slack workspace, you can send a message as a Bot in python.</p>
<p>There are few options to send messages through Slack API as a Bot !</p>
<h3 id="option-1">Option 1.</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="kn">import</span> <span class="nn">config</span>
<span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>
<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">from</span> <span class="nn">slack_sdk.errors</span> <span class="kn">import</span> <span class="n">SlackApiError</span>


<span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>

<span class="n">SLACK_BOT_TEXT</span> <span class="o">=</span> <span class="p">(</span>
    <span class="s2">&#34;HEY THERE, I FOUND A TOP 10 SONGS YOU MAY BE INTERESTED IN.&#34;</span>
    <span class="s2">&#34;THEY ARE LISTED BELOW&#34;</span>
<span class="p">)</span>

<span class="k">class</span> <span class="nc">SlackFacade</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">token</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">SLACK_BOT_TOKEN</span><span class="p">,</span> <span class="n">bot_name</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">SLACK_BOT_NAME</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">token</span> <span class="o">=</span> <span class="n">token</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">default_channel</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">DEFAULT_SLACK_CHANNEL</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bot_name</span> <span class="o">=</span> <span class="n">bot_name</span>

    <span class="k">def</span> <span class="nf">emit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">channel</span><span class="p">,</span> <span class="n">text</span><span class="p">):</span>
        <span class="s2">&#34;&#34;&#34;Sends a message to your channel 
</span><span class="s2">
</span><span class="s2">        Args:
</span><span class="s2">          channel ([String]): Specify the name of the slack channel 
</span><span class="s2">        &#34;&#34;&#34;</span>
        <span class="k">try</span><span class="p">:</span> 
            <span class="n">text_with_date</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;[%m/</span><span class="si">%d</span><span class="s1"> %H:%M:%S] &#39;</span><span class="p">)</span> <span class="o">+</span> <span class="n">text</span>
            <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
              <span class="s2">&#34;https://slack.com/api/chat.postMessage&#34;</span><span class="p">,</span>
              <span class="n">headers</span><span class="o">=</span><span class="p">{</span><span class="s2">&#34;Authorization&#34;</span><span class="p">:</span> <span class="s2">&#34;Bearer &#34;</span><span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">token</span><span class="p">},</span>
              <span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="s2">&#34;channel&#34;</span><span class="p">:</span> <span class="n">channel</span><span class="p">,</span><span class="s2">&#34;text&#34;</span><span class="p">:</span> <span class="n">text_with_date</span><span class="p">}</span>
              <span class="p">)</span>

        <span class="k">except</span> <span class="n">SlackApiError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">f</span><span class="s2">&#34;Slack encountered error: {e.response[&#39;error&#39;]}&#34;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">e</span>

<span class="k">if</span> <span class="vm">__name__</span><span class="o">==</span><span class="s2">&#34;__main__&#34;</span><span class="p">:</span>
    <span class="n">SlackFacade</span><span class="p">()</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span>
      <span class="n">channel</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">DEFAULT_SLACK_CHANNEL</span><span class="p">,</span> 
      <span class="n">text</span><span class="o">=</span><span class="n">SLACK_BOT_TEXT</span>
      <span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><p>Then, your channel will recieve a message from your app like this :</p>
<figure>
    <img src="slack_message.png"/> <figcaption>
            <h4>Message from a SongPlz bot in Slack (Option 1)</h4>
        </figcaption>
</figure>

<h3 id="option-2">Option 2.</h3>
<h4 id="code">Code</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">slack_sdk</span> <span class="kn">import</span> <span class="n">WebClient</span>
<span class="kn">from</span> <span class="nn">slack_sdk.errors</span> <span class="kn">import</span> <span class="n">SlackApiError</span>
<span class="n">block</span> <span class="o">=</span> <span class="p">{</span>
			<span class="s2">&#34;type&#34;</span><span class="p">:</span> <span class="s2">&#34;section&#34;</span><span class="p">,</span>
			<span class="s2">&#34;text&#34;</span><span class="p">:</span> <span class="p">{</span>
				<span class="s2">&#34;type&#34;</span><span class="p">:</span> <span class="s2">&#34;mrkdwn&#34;</span><span class="p">,</span>
				<span class="s2">&#34;text&#34;</span><span class="p">:</span> <span class="s2">&#34;Hello :heart: this is *SongPlz*, Do you want *Global Top 10 Song*?&#34;</span>
			<span class="p">}</span>
		<span class="p">}</span>

<span class="k">class</span> <span class="nc">SlackFacade</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">token</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">SLACK_BOT_TOKEN</span><span class="p">,</span>
                <span class="n">bot_name</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">SLACK_BOT_NAME</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">token</span> <span class="o">=</span> <span class="n">token</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">default_channel</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">DEFAULT_SLACK_CHANNEL</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bot_name</span> <span class="o">=</span> <span class="n">bot_name</span>

        <span class="c1"># Internally set properites</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client</span> <span class="o">=</span> <span class="n">WebClient</span><span class="p">(</span><span class="n">token</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">token</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">slack_message_entries</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">def</span> <span class="nf">emit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">blocks</span><span class="p">,</span> <span class="n">channel</span><span class="p">):</span>
        <span class="s2">&#34;&#34;&#34;Sends a message to your channel.
</span><span class="s2">        Args:
</span><span class="s2">            blocks: Expected to be a json-like array object containing the rich
</span><span class="s2">                text representation of the listings we&#39;ve found. The methods in
</span><span class="s2">                this object should be used to construct the Rich Message Blocks.
</span><span class="s2">                See the Slack kit builder for more information on block
</span><span class="s2">                construction: https://app.slack.com/block-kit-builder
</span><span class="s2">            channel: string, The channel to send the message to.
</span><span class="s2">        &#34;&#34;&#34;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">chat_postMessage</span><span class="p">(</span>
                <span class="n">channel</span><span class="o">=</span><span class="n">channel</span><span class="p">,</span>
                <span class="n">text</span><span class="o">=</span><span class="s2">&#34;SongPlz Incoming!&#34;</span><span class="p">,</span>
                <span class="n">blocks</span><span class="o">=</span><span class="n">blocks</span><span class="p">,</span>
                <span class="c1"># as_user must be false to set bot name</span>
                <span class="n">username</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">bot_name</span>
            <span class="p">)</span>
        <span class="k">except</span> <span class="n">SlackApiError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">f</span><span class="s2">&#34;Slack encountered an error: {e.response[&#39;error&#39;]}&#34;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">e</span>

        <span class="k">return</span> <span class="n">response</span>
        
<span class="n">SlackFacade</span><span class="p">()</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="n">blocks</span> <span class="o">=</span> <span class="p">[</span><span class="n">block</span><span class="p">],</span> <span class="n">channel</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">DEFAULT_SLACK_CHANNEL</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><figure>
    <img src="slack_message_2.png"/> <figcaption>
            <h4>Message from a SongPlz bot in Slack (Option 2)</h4>
        </figcaption>
</figure>

<h4 id="error-solved">Error (Solved)</h4>
<p>At first, I had so much struggles to fix the error encountered while tyring option 2.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-txt" data-lang="txt"># error I received
urlopen error [SSL: CERTIFICATE_VERIFY_FAILED]
certificate verify failed: unable to get local issuer certificate

</code></pre></td></tr></table>
</div>
</div><p>I tried following two methods to fix the error.</p>
<ul>
<li>
<p><strong>Method 1</strong>. (-&gt; this one failed for my case)</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">pipenv install certifi <span class="c1"># or</span>
pip install certifi 
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p><strong>Method 2</strong>. (if method 1 doesn&rsquo;t work)</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="kn">import</span> <span class="nn">ssl</span>

<span class="n">ssl</span><span class="o">.</span><span class="n">_create_default_https_context</span> <span class="o">=</span> <span class="n">ssl</span><span class="o">.</span><span class="n">_create_unverified_context</span>
</code></pre></td></tr></table>
</div>
</div></li>
</ul>
<h2 id="spotify-api">Spotify API</h2>
<p>We can use <a href="https://developer.spotify.com/documentation/web-api/reference/#/" target="_blank" rel="noopener noreffer">Spotify&rsquo;s Web API</a> to discover music and podcasts.</p>
<p>Let&rsquo;s try <strong>Search API</strong> for items, you can get Spotify catalog information about albums, aritist, playlists, tracks, shows, or episodes that math a keyword string.</p>
<blockquote>
<p><strong>Search API</strong>
<div class="details admonition note">
        <div class="details-summary admonition-title">
            <i class="icon fas fa-pencil-alt fa-fw" aria-hidden="true"></i>Request: GET /search<i class="details-icon fas fa-angle-right fa-fw" aria-hidden="true"></i>
        </div>
        <div class="details-content">
            <div class="admonition-content"><ul>
<li><strong>HEADER</strong>: Authorization -&gt; Authorized <code>Access_token</code> is requred.</li>
<li><strong>q</strong> [string]: You can narrow down your search using field filters. <code>album</code>, <code>artist</code>, <code>track</code>, <code>year</code>, <code>upc</code>, <code>tag</code>:hipster, <code>tag</code>:new, <code>isrc</code>, <code>genre</code>. e.g. `remaster%20track:Doxy+artist:Miles%20Davis&quot;
<ul>
<li>The <code>artist</code> filter can be used while searching albums, artists or tracks.</li>
<li>The <code>album</code> and <code>year</code> filters can be used while searching albums or tracks. You can filter on a single year or a range (e.g. 1955-1960).</li>
<li>The genre <code>filter</code> can be use while searching tracks and artists.</li>
<li>The <code>isrc</code> and <code>track</code> filters can be used while searching tracks.</li>
<li>The <code>upc</code>, <code>tag:new</code> and <code>tag:hipster</code> filters can only be used while searching albums. The <code>tag:new</code> filter will return albums released in the past two weeks and tag:hipster can be used to return only albums with the lowest 10% popularity.</li>
</ul>
</li>
<li><strong>type</strong> [array]: A comma-separated list of item types to search across e.g. <code>q=name:abacab&amp;type=album,track</code> meaning it will return both albums and tracks with &ldquo;abacab&rdquo; included in their name</li>
<li><strong>limit</strong> [int]: default value is 20</li>
<li><strong>market</strong> [string]: if a country code is specified, only content that is available in that market will be returned. e.g. &ldquo;ES&rdquo;</li>
<li><strong>offset</strong> [int]: The index of the first result to return.</li>
</ul>
</div>
        </div>
    </div>
<div class="details admonition note">
        <div class="details-summary admonition-title">
            <i class="icon fas fa-pencil-alt fa-fw" aria-hidden="true"></i>Reponse: 200<i class="details-icon fas fa-angle-right fa-fw" aria-hidden="true"></i>
        </div>
        <div class="details-content">
            <div class="admonition-content"><ul>
<li>
<p>Body - application/<strong>json</strong></p>
<ul>
<li><code>Tracks</code></li>
<li><code>artist</code></li>
<li><code>albums</code></li>
<li><code>playlists</code></li>
<li><code>shows</code></li>
<li><code>episodes</code></li>
</ul>
</li>
<li>
<p>Each <code>object</code> contains</p>
<ul>
<li>href [string]</li>
<li>items</li>
<li>limit</li>
<li>next</li>
<li>offset</li>
<li>previous</li>
<li>total : total number of items available to return</li>
</ul>
</li>
</ul>
</div>
        </div>
    </div></p>
</blockquote>
<h4 id="example-bts-song">Example: BTS Song</h4>
<p>We need these to use API !</p>
<ul>
<li>
<p><strong>endpoint</strong>: <a href="https://api.spotify.com/v1/search">https://api.spotify.com/v1/search</a></p>
</li>
<li>
<p><strong>method</strong>: GET</p>
</li>
<li>
<p><strong>parameter</strong>:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-json" data-lang="json"><span class="p">{</span><span class="err">&#39;q&#39;:</span> <span class="err">&#39;BTS&#39;,</span> <span class="err">&#39;type&#39;:&#39;album&#39;,</span> <span class="err">&#39;limit&#39;:</span> <span class="err">5</span><span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p><strong>HEADER</strong>:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="p">{</span><span class="s1">&#39;Authorization&#39;</span><span class="p">:</span> <span class="s1">&#39;Bearer {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">token</span><span class="p">)}</span>
</code></pre></td></tr></table>
</div>
</div></li>
</ul>
<p>This is just one of options to get a data using API, there are more ways to get a data!</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python">
<span class="n">sp</span> <span class="o">=</span> <span class="n">spotipy</span><span class="o">.</span><span class="n">Spotify</span><span class="p">(</span><span class="n">auth_manager</span><span class="o">=</span><span class="n">SpotifyClientCredentials</span><span class="p">(</span><span class="n">client_id</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">SPOTIFY_CLEINT_ID</span><span class="p">,</span>
<span class="n">client_secret</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">SPOTIFY_CLIENT_SECRET</span><span class="p">))</span>

<span class="n">results</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">q</span><span class="o">=</span><span class="s1">&#39;BTS&#39;</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>
<span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">track</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">results</span><span class="p">[</span><span class="s1">&#39;tracks&#39;</span><span class="p">][</span><span class="s1">&#39;items&#39;</span><span class="p">]):</span>
    <span class="k">print</span><span class="p">(</span><span class="n">idx</span><span class="p">,</span> <span class="n">track</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">])</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="concern-for-better-data-pipeline">Concern for Better Data Pipeline</h2>
<p>We successfully retrieved information by using Spotify API.
But, we have to think <code>HOW</code> to extract data more effectively.</p>
<p>Here are still remaining questions to answer to get better data extraction.</p>
<ul>
<li>What if there is API restriction ?</li>
<li>What if there is an error occurred in middle of the process?</li>
<li>what if API authroization token is expired ?</li>
</ul>
<h2 id="reference">Reference</h2>
<p><a href="https://www.educative.io/blog/what-are-rest-apis">https://www.educative.io/blog/what-are-rest-apis</a>
<a href="https://restfulapi.net/">https://restfulapi.net/</a>
<a href="https://www.youtube.com/watch?v=0U31-O4oEPc">https://www.youtube.com/watch?v=0U31-O4oEPc</a></p>
</div><div class="post-footer" id="post-footer">
    <div class="post-info">
        <div class="post-info-line">
            <div class="post-info-mod">
                <span>Updated on 2022-05-22</span>
            </div></div>
        <div class="post-info-line">
            <div class="post-info-md"><span>
                            <a class="link-to-markdown" href="/project2-1.-songplz-bot/index.md" target="_blank">Read Markdown</a>
                        </span></div>
            <div class="post-info-share">
                <span><a href="javascript:void(0);" title="Share on Twitter" data-sharer="twitter" data-url="http://youheekil.github.io/project2-1.-songplz-bot/" data-title="[SongPlz-Bot] 1. Slack and Spotify API"><i class="fab fa-twitter fa-fw" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Share on Facebook" data-sharer="facebook" data-url="http://youheekil.github.io/project2-1.-songplz-bot/"><i class="fab fa-facebook-square fa-fw" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Share on Hacker News" data-sharer="hackernews" data-url="http://youheekil.github.io/project2-1.-songplz-bot/" data-title="[SongPlz-Bot] 1. Slack and Spotify API"><i class="fab fa-hacker-news fa-fw" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Share on Line" data-sharer="line" data-url="http://youheekil.github.io/project2-1.-songplz-bot/" data-title="[SongPlz-Bot] 1. Slack and Spotify API"><i data-svg-src="/lib/simple-icons/icons/line.min.svg" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Share on 微博" data-sharer="weibo" data-url="http://youheekil.github.io/project2-1.-songplz-bot/" data-title="[SongPlz-Bot] 1. Slack and Spotify API"><i class="fab fa-weibo fa-fw" aria-hidden="true"></i></a></span>
            </div>
        </div>
    </div>

    <div class="post-info-more">
        <section class="post-tags"></section>
        <section>
            <span><a href="javascript:void(0);" onclick="window.history.back();">Back</a></span>&nbsp;|&nbsp;<span><a href="/">Home</a></span>
        </section>
    </div>

    <div class="post-nav"><a href="/running-kafka-docker/" class="prev" rel="prev" title="[Kafka] Running Kafka with Docker (python)"><i class="fas fa-angle-left fa-fw" aria-hidden="true"></i>[Kafka] Running Kafka with Docker (python)</a>
            <a href="/project2-2.-songplz-bot/" class="next" rel="next" title="[SongPlz-Bot] 2. Severless &amp; Data Ingestion &amp; Recommender System">[SongPlz-Bot] 2. Severless &amp; Data Ingestion &amp; Recommender System<i class="fas fa-angle-right fa-fw" aria-hidden="true"></i></a></div>
</div>
</article></div>
            </main><footer class="footer">
        <div class="footer-container"><div class="footer-line">Powered by <a href="https://gohugo.io/" target="_blank" rel="noopener noreffer" title="Hugo 0.79.1">Hugo</a> | Theme - <a href="https://github.com/dillonzq/LoveIt" target="_blank" rel="noopener noreffer" title="LoveIt 0.2.11"><i class="far fa-kiss-wink-heart fa-fw" aria-hidden="true"></i> LoveIt</a>
                </div><div class="footer-line" itemscope itemtype="http://schema.org/CreativeWork"><i class="far fa-copyright fa-fw" aria-hidden="true"></i><span itemprop="copyrightYear">2019 - 2022</span><span class="author" itemprop="copyrightHolder">&nbsp;<a href="/" target="_blank">Youhee Kil</a></span>&nbsp;|&nbsp;<span class="license"><a rel="license external nofollow noopener noreffer" href="https://creativecommons.org/licenses/by-nc/4.0/" target="_blank">CC BY-NC 4.0</a></span></div>
        </div>
    </footer></div>

        <div id="fixed-buttons"><a href="#" id="back-to-top" class="fixed-button" title="Back to Top">
                <i class="fas fa-arrow-up fa-fw" aria-hidden="true"></i>
            </a><a href="#" id="view-comments" class="fixed-button" title="View Comments">
                <i class="fas fa-comment fa-fw" aria-hidden="true"></i>
            </a>
        </div><link rel="stylesheet" href="/lib/lightgallery/lightgallery.min.css"><link rel="stylesheet" href="/lib/katex/katex.min.css"><link rel="stylesheet" href="/lib/katex/copy-tex.min.css"><link rel="stylesheet" href="/lib/cookieconsent/cookieconsent.min.css"><script type="text/javascript" src="/lib/autocomplete/autocomplete.min.js"></script><script type="text/javascript" src="/lib/lunr/lunr.min.js"></script><script type="text/javascript" src="/lib/lazysizes/lazysizes.min.js"></script><script type="text/javascript" src="/lib/twemoji/twemoji.min.js"></script><script type="text/javascript" src="/lib/lightgallery/lightgallery.min.js"></script><script type="text/javascript" src="/lib/lightgallery/plugins/lg-thumbnail.min.js"></script><script type="text/javascript" src="/lib/lightgallery/plugins/lg-zoom.min.js"></script><script type="text/javascript" src="/lib/clipboard/clipboard.min.js"></script><script type="text/javascript" src="/lib/sharer/sharer.min.js"></script><script type="text/javascript" src="/lib/typeit/index.umd.js"></script><script type="text/javascript" src="/lib/katex/katex.min.js"></script><script type="text/javascript" src="/lib/katex/auto-render.min.js"></script><script type="text/javascript" src="/lib/katex/copy-tex.min.js"></script><script type="text/javascript" src="/lib/katex/mhchem.min.js"></script><script type="text/javascript" src="/lib/cookieconsent/cookieconsent.min.js"></script><script type="text/javascript">window.config={"code":{"copyTitle":"Copy to clipboard","maxShownLines":50},"comment":{},"cookieconsent":{"content":{"dismiss":"Got it!","link":"Learn more","message":"This website uses Cookies to improve your experience."},"enable":true,"palette":{"button":{"background":"#f0f0f0"},"popup":{"background":"#1aa3ff"}},"theme":"edgeless"},"data":{"id-1":"YOUHEE","id-2":"YOUHEE"},"lightgallery":true,"math":{"delimiters":[{"display":true,"left":"$$","right":"$$"},{"display":true,"left":"\\[","right":"\\]"},{"display":true,"left":"\\begin{equation}","right":"\\end{equation}"},{"display":true,"left":"\\begin{equation*}","right":"\\end{equation*}"},{"display":true,"left":"\\begin{align}","right":"\\end{align}"},{"display":true,"left":"\\begin{align*}","right":"\\end{align*}"},{"display":true,"left":"\\begin{alignat}","right":"\\end{alignat}"},{"display":true,"left":"\\begin{alignat*}","right":"\\end{alignat*}"},{"display":true,"left":"\\begin{gather}","right":"\\end{gather}"},{"display":true,"left":"\\begin{CD}","right":"\\end{CD}"},{"display":false,"left":"$","right":"$"},{"display":false,"left":"\\(","right":"\\)"}],"strict":false},"search":{"highlightTag":"em","lunrIndexURL":"/index.json","maxResultLength":10,"noResultsFound":"No results found","snippetLength":30,"type":"lunr"},"twemoji":true,"typeit":{"cursorChar":"|","cursorSpeed":1000,"data":{"id-1":["id-1"],"id-2":["id-2"]},"duration":-1,"speed":100}};</script><script type="text/javascript" src="/js/theme.min.js"></script></body>
</html>
